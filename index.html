<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Hadron Lab Ver 7.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=M+PLUS+Rounded+1c:wght@700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* ===== Hadron Lab 7.0 KanColle Style ===== */
        :root {
            --hc-bg: #0a0e14;
            --hc-panel: #151922;
            --hc-border: #333;
            --hc-orange: #f39c12;
            --hc-blue: #3498db;
            --hc-green: #2ecc71;
            --hc-purple: #9b59b6;
            --hc-red: #e74c3c;
            --hc-text: #ecf0f1;
        }

        body { margin: 0; background: var(--hc-bg); color: var(--hc-text); font-family: 'M PLUS Rounded 1c', sans-serif; overflow: hidden; user-select: none; }

        /* èƒŒæ™¯ç”»åƒè¨­å®š */
        .lab-container {
            width: 100vw; height: 100vh; position: relative;
            background-image: url('images/lab_bg.png'); 
            background-size: cover; background-position: center; 
            background-color: var(--hc-bg);
        }

        /* --- 1. ãƒˆãƒƒãƒ—ãƒãƒ¼ (è³‡æº) --- */
        .top-bar {
            position: absolute; top: 0; left: 0; width: 100%; height: 50px;
            background: rgba(0,0,0,0.6); 
            display: flex; align-items: center; padding: 0 20px; gap: 20px; z-index: 100;
        }
        .status-box {
            background: rgba(40, 50, 60, 0.8); padding: 5px 15px; border-radius: 2px; border: 1px solid #555;
            display: flex; align-items: center; gap: 10px; font-family: 'Orbitron'; font-size: 0.9rem;
        }

        /* --- 2. ã‚µã‚¤ãƒ‰ãƒãƒ¼ (ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¡¨ç¤ºæ™‚ã®ã¿ä½¿ç”¨) --- */
        .sidebar {
            position: absolute; top: 50px; left: 0; bottom: 0; width: 60px; /* æ™®æ®µã¯ç´°ã */
            background: rgba(0,0,0,0.8); border-right: 1px solid #444; 
            display: flex; flex-direction: column; z-index: 90; transition: 0.2s;
            overflow: hidden;
        }
        .sidebar:hover { width: 220px; } /* ãƒ›ãƒãƒ¼ã§åºƒãŒã‚‹ */
        
        .menu-item {
            height: 50px; display: flex; align-items: center; padding-left: 15px;
            color: #aaa; cursor: pointer; white-space: nowrap; transition: 0.2s;
            border-bottom: 1px solid #222;
        }
        .menu-item:hover, .menu-item.active { background: var(--hc-blue); color: white; }
        .menu-icon { width: 30px; font-size: 1.2rem; text-align: center; margin-right: 10px; }

        /* --- 3. ãƒ¡ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼ (ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦) --- */
        .main-view {
            position: absolute; top: 50px; left: 0; right: 0; bottom: 0;
            padding: 40px; overflow-y: auto; display: none;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            animation: fadeIn 0.3s; z-index: 80; padding-left: 80px; /* ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆ†ç©ºã‘ã‚‹ */
        }
        .main-view.active { display: block; }

        /* --- 4. ãƒ›ãƒ¼ãƒ ç”»é¢ (æ¯æ¸¯) UI --- */
        #view-home {
            background: transparent; backdrop-filter: none; padding: 0;
            pointer-events: none; /* èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯é€é */
        }
        
        /* ã‚®ã‚¢å‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ */
        .home-menu-container {
            position: absolute; top: 50%; left: 300px; /* å·¦å¯„ã‚Šã«é…ç½® */
            transform: translateY(-50%);
            width: 600px; height: 600px;
            pointer-events: auto;
        }

        /* å…±é€šãƒœã‚¿ãƒ³ã‚¿ã‚¤ãƒ« */
        .gear-btn {
            position: absolute; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            cursor: pointer; transition: 0.2s;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            font-family: 'Orbitron', sans-serif; font-weight: bold;
            text-shadow: 1px 1px 2px black; border: 2px solid rgba(255,255,255,0.2);
        }
        .gear-btn:hover { transform: scale(1.1); z-index: 10; filter: brightness(1.2); }
        .gear-btn:active { transform: scale(0.95); }

        /* å›è»¢ã™ã‚‹ã‚®ã‚¢è£…é£¾ (pseudo-element) */
        .gear-btn::before {
            content: ""; position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px;
            border-radius: 50%; border: 2px dashed rgba(255,255,255,0.3);
            animation: spin 20s linear infinite; pointer-events: none;
        }
        .gear-btn:hover::before { border-color: rgba(255,255,255,0.8); animation-duration: 5s; }

        /* â˜…ãƒ¡ã‚¤ãƒ³ï¼šPROPOSAL (å‡ºæ’ƒãƒã‚¸ã‚·ãƒ§ãƒ³) */
        .btn-main {
            width: 180px; height: 180px;
            background: radial-gradient(circle, #e67e22, #d35400);
            border: 4px solid #f1c40f;
            color: #fff; font-size: 1.5rem;
            top: 50%; left: 50%; transform: translate(-50%, -50%); /* ä¸­å¤® */
        }
        .btn-main:hover { transform: translate(-50%, -50%) scale(1.05); }

        /* ã‚µãƒ–ï¼šSHOP (è£œçµ¦ãƒã‚¸ã‚·ãƒ§ãƒ³ - å·¦ä¸Š) */
        .btn-shop {
            width: 100px; height: 100px; background: #2ecc71; color: white;
            top: 25%; left: 25%; font-size: 0.9rem;
        }
        
        /* ã‚µãƒ–ï¼šCRAFT (å·¥å» ãƒã‚¸ã‚·ãƒ§ãƒ³ - å·¦ä¸‹) */
        .btn-craft {
            width: 100px; height: 100px; background: #7f8c8d; color: white;
            top: 60%; left: 25%; font-size: 0.9rem;
        }

        /* ã‚µãƒ–ï¼šOFFICE (å…¥æ¸ ãƒã‚¸ã‚·ãƒ§ãƒ³ - ä¸‹) */
        .btn-office {
            width: 100px; height: 100px; background: #3498db; color: white;
            top: 75%; left: 50%; transform: translateX(-50%); font-size: 0.9rem;
        }
        .btn-office:hover { transform: translateX(-50%) scale(1.1); }

        /* ã‚µãƒ–ï¼šBATTLE (æ¼”ç¿’ãƒã‚¸ã‚·ãƒ§ãƒ³ - å³ä¸‹) */
        .btn-battle {
            width: 110px; height: 110px; background: #c0392b; color: white;
            top: 60%; right: 20%; font-size: 1rem; border-color: #e74c3c;
        }

        /* ç§˜æ›¸è‰¦ã‚¨ãƒªã‚¢ */
        .secretary-area {
            position: absolute; right: -50px; bottom: 0; height: 95vh; width: 60vw;
            pointer-events: none; display: flex; align-items: flex-end; justify-content: flex-end;
            z-index: 5;
        }
        .secretary-img {
            max-height: 100%; max-width: 100%; object-fit: contain;
            filter: drop-shadow(-10px 0 20px rgba(0,0,0,0.5));
            pointer-events: auto; cursor: help;
        }

        /* æ™‚è¨ˆ */
        .clock-widget {
            position: absolute; bottom: 20px; left: 20px;
            font-family: 'Orbitron'; font-size: 3rem; color: rgba(255,255,255,0.8);
            text-shadow: 0 0 10px rgba(0,0,0,0.8); pointer-events: none;
        }

        /* --- å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
        .proposal-paper, .shop-grid, .paper-list { /* ä»¥å‰ã¨åŒã˜ */
            max-width: 900px; margin: 0 auto;
        }
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .item-card {
            background: var(--hc-panel); border: 1px solid var(--hc-border); padding: 15px;
            border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s;
        }
        .item-card:hover { border-color: var(--hc-green); background: #1a2520; }
        
        .bubble {
            position: absolute; right: 350px; top: 150px;
            background: white; color: #333; padding: 15px; border-radius: 15px;
            max-width: 250px; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: none; animation: popIn 0.3s; z-index: 20;
        }
        .bubble::after {
            content: ''; position: absolute; right: -10px; top: 50%;
            border-width: 10px; border-style: solid; border-color: transparent transparent transparent white;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 200; display: none;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--hc-panel); padding: 30px; border: 1px solid var(--hc-blue);
            border-radius: 10px; max-width: 500px; text-align: center; color: white;
            box-shadow: 0 0 50px rgba(52, 152, 219, 0.3);
        }

        /* Proposal Form Styles */
        .proposal-paper { background: #eee; padding: 30px; border-radius: 5px; color: #333; }
        select { width: 100%; padding: 10px; margin-bottom: 20px; }
        .submit-btn { width: 100%; padding: 15px; background: var(--hc-blue); color: white; border: none; font-size: 1.2rem; cursor: pointer; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div class="lab-container">
        <div class="top-bar">
            <div style="font-family:'Orbitron'; font-weight:bold; color:#aaa; margin-right:20px;">HADRON LAB</div>
            <div class="status-box" style="border-color:var(--hc-green);">
                <span>ğŸ’´ BUDGET:</span>
                <span id="disp-money" style="color:var(--hc-green); font-weight:bold;">0</span>
            </div>
            <div class="status-box">
                <span>ğŸ“¦ MATERIAL</span>
            </div>
            <div style="flex-grow:1;"></div>
            <div class="status-box" style="border-color:var(--hc-orange);">
                <span>RANK: </span>
                <span id="disp-rank">Master 1</span>
            </div>
        </div>

        <div class="sidebar">
            <div class="menu-item active" onclick="showHome()">
                <div class="menu-icon">ğŸ </div> <span>HOME PORT</span>
            </div>
            <div class="menu-item" onclick="showView('view-shop')">
                <div class="menu-icon">ğŸ›’</div> <span>SUPPLY</span>
            </div>
            <div class="menu-item" onclick="showView('view-craft')">
                <div class="menu-icon">ğŸ› </div> <span>FACTORY</span>
            </div>
            <div class="menu-item" onclick="showView('view-proposal')">
                <div class="menu-icon">ğŸ“</div> <span>PROPOSAL</span>
            </div>
            <div class="menu-item" onclick="showView('view-office')">
                <div class="menu-icon">ğŸ“</div> <span>ARCHIVE</span>
            </div>
        </div>
        
        <div class="bubble" id="secretary-bubble">æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ</div>
        <div class="secretary-area">
            <img id="secretary-img" class="secretary-img" src="" onclick="talkSecretary()">
        </div>

        <div class="clock-widget" id="clock">12:00</div>

        <div id="view-home" class="main-view active">
            <div class="home-menu-container">
                <div class="gear-btn btn-main" onclick="showView('view-proposal')">
                    <div style="font-size:2.5rem;">âš¡</div>
                    <div>EXP. START</div>
                    <div style="font-size:0.7rem;">(PROPOSAL)</div>
                </div>

                <div class="gear-btn btn-shop" onclick="showView('view-shop')">
                    <div style="font-size:1.5rem;">ğŸ›’</div>
                    <div>SUPPLY</div>
                </div>

                <div class="gear-btn btn-craft" onclick="showView('view-craft')">
                    <div style="font-size:1.5rem;">ğŸ› </div>
                    <div>CRAFT</div>
                </div>

                <div class="gear-btn btn-office" onclick="showView('view-office')">
                    <div style="font-size:1.5rem;">ğŸ“‚</div>
                    <div>ARCHIVE</div>
                </div>

                <div class="gear-btn btn-battle" onclick="location.href='battle.html'">
                    <div style="font-size:1.5rem;">âš”ï¸</div>
                    <div>BATTLE</div>
                    <div style="font-size:0.6rem;">(LOOT)</div>
                </div>
            </div>
        </div>

        <div id="view-shop" class="main-view">
            <h2 style="font-family:'Orbitron'; color:var(--hc-green);">MATERIAL SUPPLY</h2>
            <div id="shop-list" class="shop-grid"></div>
        </div>

        <div id="view-craft" class="main-view">
            <h2 style="font-family:'Orbitron'; color:#aaa;">DETECTOR WORKSHOP</h2>
            <div id="craft-list" class="shop-grid"></div>
        </div>

        <div id="view-proposal" class="main-view">
            <div class="proposal-paper">
                <h1 style="text-align:center; border-bottom:2px solid #333;">Experiment Proposal</h1>
                <p>ãƒ“ãƒ¼ãƒ ã€æ¨™çš„ã€æ¤œå‡ºå™¨ã‚’é¸æŠã—ã¦å®Ÿé¨“è¨ˆç”»æ›¸ã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚</p>
                <div style="margin-bottom:15px;">
                    <label>1. BEAM SOURCE</label>
                    <select id="sel-beam" onchange="calcProposalCost()"></select>
                </div>
                <div style="margin-bottom:15px;">
                    <label>2. TARGET</label>
                    <select id="sel-target" onchange="calcProposalCost()"></select>
                </div>
                <div style="margin-bottom:15px;">
                    <label>3. DETECTOR</label>
                    <select id="sel-detector" onchange="calcProposalCost()"></select>
                </div>
                <div style="text-align:right; border-top:1px solid #ccc; padding-top:10px;">
                    <div style="font-size:1.2rem; font-weight:bold; margin-bottom:10px;">COST: Â¥<span id="prop-cost">0</span></div>
                    <button id="btn-start-exp" class="submit-btn" onclick="runExperiment()">SUBMIT PROPOSAL</button>
                    <div id="exp-error" style="color:red; display:none;">Cost or Equipment Error</div>
                </div>
            </div>
        </div>

        <div id="view-office" class="main-view">
            <h2 style="font-family:'Orbitron'; color:var(--hc-blue);">ACADEMIC OFFICE</h2>
            <div id="particle-stock-list" class="paper-list"></div>
        </div>

    </div>

    <div id="result-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:var(--hc-green);">Experiment Successful!</h2>
            <div id="exp-result-content"></div>
            <button onclick="document.getElementById('result-modal').style.display='none'" style="margin-top:20px; padding:10px 30px; background:var(--hc-blue); border:none; color:white; cursor:pointer;">CONFIRM</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // === GAME DATA ===
        const materials = [
            { id: 'm1', name: 'Dry Ice', icon: 'ğŸ§Š', cost: 500 },
            { id: 'm2', name: 'Alcohol', icon: 'ğŸ§ª', cost: 300 },
            { id: 'm3', name: 'PMT', icon: 'ğŸ’¡', cost: 5000 },
            { id: 'm4', name: 'Scintillator', icon: 'âœ¨', cost: 3000 },
            { id: 'm5', name: 'Optical Fiber', icon: 'â°', cost: 2000 },
            { id: 'm6', name: 'MPPC', icon: 'ğŸ¤', cost: 8000 }
        ];
        const detectors = [
            { id: 'd1', name: 'Cloud Chamber', req: {m1:1, m2:1}, power: 1 },
            { id: 'd2', name: 'Scintillator Counter', req: {m3:1, m4:1}, power: 3 },
            { id: 'd3', name: 'Fiber Tracker', req: {m5:5, m6:5}, power: 8 }
        ];
        const beams = [
            { id: 'b1', name: 'Cosmic Ray', cost: 0, power: 1 },
            { id: 'b2', name: 'RI Source', cost: 5000, power: 3 },
            { id: 'b3', name: 'Cyclotron', cost: 50000, power: 10 },
            { id: 'b4', name: 'Synchrotron', cost: 200000, power: 50 }
        ];
        const targets = [
            { id: 't1', name: 'Air', cost: 0, power: 1 },
            { id: 't2', name: 'Gold Foil', cost: 10000, power: 2 },
            { id: 't3', name: 'Liq. Hydrogen', cost: 50000, power: 5 }
        ];
        const particles = [
            { id: 1, name: "Muon", rarity: 1 }, { id: 2, name: "Electron", rarity: 1 },
            { id: 3, name: "Proton", rarity: 1 }, { id: 4, name: "Pion", rarity: 2 },
            { id: 5, name: "Kaon", rarity: 3 }, { id: 6, name: "J/psi", rarity: 4 },
            { id: 7, name: "Higgs", rarity: 5 }
        ];

        let user = { money: 10000, invMat: {}, invDet: [], invPart: {}, secretary: 1 };

        window.onload = function() {
            try {
                loadGame();
                refreshUI();
                initProposalForm();
                setSecretaryDisplay();
                updateClock();
                setInterval(updateClock, 1000);
            } catch(e) { console.error(e); }
        };

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function showHome() {
            document.querySelectorAll('.main-view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-home').classList.add('active');
        }
        function showView(viewId) {
            document.querySelectorAll('.main-view').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        function refreshUI() {
            document.getElementById('disp-money').innerText = user.money.toLocaleString();
            renderShop(); renderCraft(); renderOffice();
        }

        function setSecretaryDisplay() {
            document.getElementById('secretary-img').src = "images/proton.png"; // ç°¡æ˜“
        }
        function talkSecretary() {
            const bub = document.getElementById('secretary-bubble');
            bub.style.display = 'block'; setTimeout(()=>bub.style.display='none', 3000);
        }

        // Logic
        function renderShop() {
            const el = document.getElementById('shop-list'); el.innerHTML = '';
            materials.forEach(m => {
                const c = user.invMat[m.id]||0;
                el.innerHTML += `<div class="item-card" onclick="buyMaterial('${m.id}')"><div style="font-size:2rem">${m.icon}</div><div>${m.name}</div><div style="color:var(--hc-green)">Â¥${m.cost.toLocaleString()}</div><div>Own: ${c}</div></div>`;
            });
        }
        function buyMaterial(id) {
            const item = materials.find(m => m.id === id);
            if(user.money >= item.cost) { user.money -= item.cost; user.invMat[id] = (user.invMat[id]||0)+1; saveGame(); refreshUI(); }
            else alert("è³‡é‡‘ä¸è¶³");
        }
        function renderCraft() {
            const el = document.getElementById('craft-list'); el.innerHTML = '';
            detectors.forEach(d => {
                const owned = user.invDet.includes(d.id);
                let reqStr = Object.keys(d.req).map(k => `${materials.find(m=>m.id==k).name} x${d.req[k]}`).join(' ');
                el.innerHTML += `<div class="item-card" style="border-color:${owned?'var(--hc-blue)':''}" onclick="craftDetector('${d.id}')"><div style="color:var(--hc-orange)">${d.name}</div><div style="font-size:0.8rem">${reqStr}</div><div>${owned?'OWNED':'CRAFT'}</div></div>`;
            });
        }
        function craftDetector(id) {
            if(user.invDet.includes(id)) { alert("æ‰€æŒæ¸ˆ"); return; }
            const det = detectors.find(d => d.id === id);
            for(let k in det.req) if((user.invMat[k]||0) < det.req[k]) { alert("ç´ æä¸è¶³"); return; }
            for(let k in det.req) user.invMat[k] -= det.req[k];
            user.invDet.push(id); alert("ä½œæˆå®Œäº†"); saveGame(); refreshUI(); initProposalForm();
        }

        function initProposalForm() {
            const sb=document.getElementById('sel-beam'), st=document.getElementById('sel-target'), sd=document.getElementById('sel-detector');
            sb.innerHTML = beams.map(b=>`<option value="${b.id}">${b.name} (Â¥${b.cost})</option>`).join('');
            st.innerHTML = targets.map(t=>`<option value="${t.id}">${t.name} (Â¥${t.cost})</option>`).join('');
            if(user.invDet.length==0) sd.innerHTML='<option value="">(æ©Ÿæãªã—)</option>';
            else sd.innerHTML = user.invDet.map(did=>`<option value="${did}">${detectors.find(x=>x.id==did).name}</option>`).join('');
            calcProposalCost();
        }
        function calcProposalCost() {
            const bId=document.getElementById('sel-beam').value, tId=document.getElementById('sel-target').value;
            if(!bId||!tId) return;
            const cost = beams.find(x=>x.id==bId).cost + targets.find(x=>x.id==tId).cost;
            document.getElementById('prop-cost').innerText = cost.toLocaleString();
            const btn=document.getElementById('btn-start-exp'), err=document.getElementById('exp-error');
            if(user.money < cost || user.invDet.length==0) { btn.disabled=true; err.style.display='block'; } else { btn.disabled=false; err.style.display='none'; }
        }
        function runExperiment() {
            const b=beams.find(x=>x.id==document.getElementById('sel-beam').value);
            const t=targets.find(x=>x.id==document.getElementById('sel-target').value);
            const d=detectors.find(x=>x.id==document.getElementById('sel-detector').value);
            user.money -= (b.cost + t.cost);
            const pow = b.power * t.power * d.power;
            let p = particles[0]; const r = Math.random()*100;
            if(pow>50 && r<5) p=particles[6]; else if(pow>20 && r<10) p=particles[5]; else if(pow>10 && r<20) p=particles[4]; else if(r<40) p=particles[3]; else if(r<60) p=particles[2];
            user.invPart[p.id] = (user.invPart[p.id]||0)+1;
            saveGame(); refreshUI();
            document.getElementById('exp-result-content').innerHTML = `<h3>Result: ${p.name}</h3><p>${p.rarity>=4?'Rare Discovery!':''}</p>`;
            document.getElementById('result-modal').style.display='flex';
        }

        function renderOffice() {
            const el=document.getElementById('particle-stock-list'); el.innerHTML='';
            let has=false;
            particles.forEach(p=>{
                const c=user.invPart[p.id]||0;
                if(c>0) { has=true; el.innerHTML+=`<div class="paper-card"><div>${p.name} Data: ${c}</div><button class="publish-btn" onclick="pub(${p.id})">PUBLISH (Â¥${p.rarity*2000})</button></div>`; }
            });
            if(!has) el.innerHTML='<p>ãƒ‡ãƒ¼ã‚¿ãªã—</p>';
        }
        function pub(pid) {
            if((user.invPart[pid]||0)<=0) return;
            const p=particles.find(x=>x.id==pid);
            user.invPart[pid]--; user.money+=p.rarity*2000;
            alert("è³‡é‡‘ç²å¾—"); saveGame(); refreshUI();
        }

        function saveGame() { localStorage.setItem('hadron_v6', JSON.stringify(user)); }
        function loadGame() {
            const d=localStorage.getItem('hadron_v6'); if(d) user=JSON.parse(d);
            if(!user.invMat) user.invMat={}; if(!user.invDet) user.invDet=[]; if(!user.invPart) user.invPart={};
        }
    </script>
</body>
</html>
