<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Hadron Lab Ver 6.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=M+PLUS+Rounded+1c:wght@700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* ===== Hadron Lab 6.0 Proposal Edition ===== */
        :root {
            --hc-bg: #0a0e14;
            --hc-panel: #151922;
            --hc-border: #333;
            --hc-orange: #f39c12;
            --hc-blue: #3498db;
            --hc-green: #2ecc71;
            --hc-purple: #9b59b6;
            --hc-red: #e74c3c;
            --hc-text: #ecf0f1;
        }

        body { margin: 0; background: var(--hc-bg); color: var(--hc-text); font-family: 'M PLUS Rounded 1c', sans-serif; overflow: hidden; user-select: none; }

        /* èƒŒæ™¯ç”»åƒè¨­å®š */
        .lab-container {
            width: 100vw; height: 100vh; position: relative;
            background-image: url('images/lab_bg.png'); 
            background-size: cover; background-position: center; 
            background-color: var(--hc-bg);
        }

        /* --- UI Components --- */
        
        /* ãƒˆãƒƒãƒ—ãƒãƒ¼ */
        .top-bar {
            position: absolute; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--hc-border);
            display: flex; align-items: center; padding: 0 20px; gap: 20px; z-index: 100;
        }
        .status-box {
            background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px;
            display: flex; align-items: center; gap: 10px; font-family: 'Orbitron';
        }

        /* å·¦ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .sidebar {
            position: absolute; top: 60px; left: 0; bottom: 0; width: 240px;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            border-right: 1px solid var(--hc-border); padding: 20px;
            display: flex; flex-direction: column; gap: 10px; z-index: 90;
        }
        .menu-item {
            padding: 15px; background: var(--hc-panel); border: 1px solid var(--hc-border);
            border-radius: 5px; cursor: pointer; transition: 0.2s; color: #aaa;
            display: flex; align-items: center; gap: 10px;
        }
        .menu-item:hover, .menu-item.active {
            background: var(--hc-blue); color: white; border-color: white; transform: translateX(5px);
        }
        .menu-item.battle { background: linear-gradient(90deg, #8e44ad, #c0392b); color: white; border: none; }

        /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼ˆåˆ‡ã‚Šæ›¿ãˆè¡¨ç¤ºï¼‰ */
        .main-view {
            position: absolute; top: 60px; left: 240px; right: 0; bottom: 0;
            padding: 30px; overflow-y: auto; display: none;
        }
        .main-view.active { display: block; animation: fadeIn 0.3s; }

        /* --- å„ç”»é¢ã‚¹ã‚¿ã‚¤ãƒ« --- */

        /* 1. Shop & Materials */
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .item-card {
            background: var(--hc-panel); border: 1px solid var(--hc-border); padding: 15px;
            border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s;
        }
        .item-card:hover { border-color: var(--hc-green); background: #1a2520; }
        .item-icon { font-size: 2.5rem; margin-bottom: 10px; }

        /* 2. Proposal Form */
        .proposal-paper {
            background: #fff; color: #333; padding: 40px; border-radius: 5px;
            max-width: 800px; margin: 0 auto; box-shadow: 0 0 30px rgba(0,0,0,0.5);
            font-family: 'Noto Sans JP', sans-serif; position: relative;
        }
        .proposal-paper::before {
            content: "CONFIDENTIAL"; position: absolute; top: 20px; right: 20px;
            color: rgba(255,0,0,0.2); font-size: 3rem; font-weight: bold; transform: rotate(-15deg);
        }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: bold; margin-bottom: 5px; border-left: 4px solid var(--hc-blue); padding-left: 10px; }
        select { width: 100%; padding: 10px; font-size: 1.1rem; border: 2px solid #ccc; border-radius: 5px; background: #f9f9f9; }
        .submit-btn {
            width: 100%; padding: 15px; background: var(--hc-blue); color: white;
            border: none; font-size: 1.5rem; font-weight: bold; cursor: pointer; margin-top: 20px;
        }
        .submit-btn:disabled { background: #999; cursor: not-allowed; }

        /* 3. Academic Office */
        .paper-list { display: flex; flex-direction: column; gap: 10px; }
        .paper-card {
            background: #fff; color: #333; padding: 15px; border-radius: 5px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .publish-btn {
            background: var(--hc-green); color: white; border: none; padding: 10px 20px;
            border-radius: 5px; cursor: pointer; font-weight: bold;
        }

        /* å…±é€šãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 200; display: none;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--hc-panel); padding: 30px; border: 1px solid var(--hc-blue);
            border-radius: 10px; max-width: 500px; text-align: center;
            box-shadow: 0 0 50px rgba(52, 152, 219, 0.3);
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div class="lab-container">
        <div class="top-bar">
            <div class="status-box" style="border:1px solid var(--hc-green);">
                <span>ğŸ’´ BUDGET:</span>
                <span id="disp-money" style="color:var(--hc-green); font-weight:bold;">0</span>
            </div>
            <div class="status-box">
                <span>ğŸ“¦ STORAGE</span>
            </div>
            <div style="flex-grow:1;"></div>
            <div class="status-box" style="border:1px solid var(--hc-orange);">
                <span>LAB RANK: </span>
                <span id="disp-rank">Master 1</span>
            </div>
        </div>

        <div class="sidebar">
            <div class="menu-item active" onclick="showView('view-shop')">
                <span>ğŸ›’ MATERIAL SHOP</span>
            </div>
            <div class="menu-item" onclick="showView('view-craft')">
                <span>ğŸ›  WORKSHOP</span>
            </div>
            <div class="menu-item" onclick="showView('view-proposal')">
                <span>ğŸ“ PROPOSAL</span>
            </div>
            <div class="menu-item" onclick="showView('view-office')">
                <span>ğŸ“ ACADEMIC OFFICE</span>
            </div>
            <div style="flex-grow:1;"></div>
            <div class="menu-item battle" onclick="location.href='battle.html'">
                <span>âš”ï¸ SORTIE (BATTLE)</span>
            </div>
        </div>

        <div id="view-shop" class="main-view active">
            <h2 style="font-family:'Orbitron'">MATERIAL SUPPLY</h2>
            <div id="shop-list" class="shop-grid"></div>
        </div>

        <div id="view-craft" class="main-view">
            <h2 style="font-family:'Orbitron'">DETECTOR WORKSHOP</h2>
            <p style="color:#aaa;">è³‡æã‚’çµ„ã¿åˆã‚ã›ã¦æ¤œå‡ºå™¨ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
            <div id="craft-list" class="shop-grid"></div>
        </div>

        <div id="view-proposal" class="main-view">
            <div class="proposal-paper">
                <h1 style="text-align:center; border-bottom:2px solid #333; padding-bottom:10px;">Experiment Proposal</h1>
                
                <div class="form-group">
                    <label class="form-label">1. BEAM SOURCE (ãƒ“ãƒ¼ãƒ æº)</label>
                    <select id="sel-beam" onchange="calcProposalCost()"></select>
                </div>

                <div class="form-group">
                    <label class="form-label">2. TARGET (æ¨™çš„)</label>
                    <select id="sel-target" onchange="calcProposalCost()"></select>
                </div>

                <div class="form-group">
                    <label class="form-label">3. DETECTOR (æ¤œå‡ºå™¨)</label>
                    <select id="sel-detector" onchange="calcProposalCost()"></select>
                    <div style="font-size:0.8rem; color:#666; margin-top:5px;">â€»æ‰€æŒã—ã¦ã„ã‚‹æ¤œå‡ºå™¨ã®ã¿é¸æŠå¯èƒ½ã§ã™</div>
                </div>

                <div style="border-top:2px solid #333; margin-top:30px; padding-top:20px; text-align:right;">
                    <div style="font-size:1.2rem; font-weight:bold;">ESTIMATED COST: <span id="prop-cost">0</span> JPY</div>
                    <button id="btn-start-exp" class="submit-btn" onclick="runExperiment()">SUBMIT & START</button>
                    <div id="exp-error" style="color:red; font-size:0.9rem; display:none;">è³‡é‡‘ã¾ãŸã¯æ©ŸæãŒä¸è¶³ã—ã¦ã„ã¾ã™</div>
                </div>
            </div>
        </div>

        <div id="view-office" class="main-view">
            <h2 style="font-family:'Orbitron'">ACADEMIC OFFICE</h2>
            <p>ç™ºè¦‹ã—ãŸç²’å­ã®è§£æçµæœã‚’è«–æ–‡ã¨ã—ã¦ç™ºè¡¨ã—ã€ç ”ç©¶è²»ã‚’ç²å¾—ã—ã¾ã™ã€‚</p>
            <div id="particle-stock-list" class="paper-list"></div>
        </div>

    </div>

    <div id="result-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:var(--hc-green);">Experiment Successful!</h2>
            <div id="exp-result-content"></div>
            <button onclick="document.getElementById('result-modal').style.display='none'" style="margin-top:20px; padding:10px 30px; cursor:pointer;">OK</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // === GAME DATA ===
        const materials = [
            { id: 'm1', name: 'Dry Ice', icon: 'ğŸ§Š', cost: 500, desc: 'éœ§ç®±ã®å†·å´ç”¨' },
            { id: 'm2', name: 'Alcohol', icon: 'ğŸ§ª', cost: 300, desc: 'éœ§ç®±ã®è’¸æ°—ç”¨' },
            { id: 'm3', name: 'PMT', icon: 'ğŸ’¡', cost: 5000, desc: 'å…‰é›»å­å¢—å€ç®¡' },
            { id: 'm4', name: 'Scintillator', icon: 'âœ¨', cost: 3000, desc: 'ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã‚·ãƒ³ãƒãƒ¬ãƒ¼ã‚¿' },
            { id: 'm5', name: 'Optical Fiber', icon: 'â°', cost: 2000, desc: 'å…‰ãƒ•ã‚¡ã‚¤ãƒãƒ¼' },
            { id: 'm6', name: 'MPPC', icon: 'ğŸ¤', cost: 8000, desc: 'åŠå°ä½“å…‰æ¤œå‡ºå™¨' }
        ];

        const detectors = [
            { id: 'd1', name: 'Cloud Chamber (éœ§ç®±)', req: {m1:1, m2:1}, power: 1, desc: 'å®‡å®™ç·šã‚’ç›®è¦–è¦³æ¸¬ã§ãã‚‹åŸå§‹çš„ãªè£…ç½®ã€‚' },
            { id: 'd2', name: 'Scintillator Counter', req: {m3:1, m4:1}, power: 3, desc: 'é›»æ°—ä¿¡å·ã§ç²’å­ã‚’æ•°ãˆã‚‹è£…ç½®ã€‚' },
            { id: 'd3', name: 'Fiber Tracker', req: {m5:5, m6:5}, power: 8, desc: 'ç²’å­ã®é£›è·¡ã‚’ç²¾å¯†ã«æ‰ãˆã‚‹è£…ç½®ã€‚' }
        ];

        const beams = [
            { id: 'b1', name: 'Cosmic Ray (å®‡å®™ç·š)', cost: 0, power: 1, desc: 'ç„¡æ–™ã€‚ç©ºã‹ã‚‰é™ã£ã¦ãã‚‹ã€‚' },
            { id: 'b2', name: 'RI Source (Sr-90)', cost: 5000, power: 3, desc: 'ãƒ™ãƒ¼ã‚¿ç·šæºã€‚å®‰ä¾¡ãªå®Ÿé¨“ç”¨ã€‚' },
            { id: 'b3', name: 'Cyclotron (50MeV)', cost: 50000, power: 10, desc: 'ä¸­è¦æ¨¡åŠ é€Ÿå™¨ã€‚' },
            { id: 'b4', name: 'Synchrotron (30GeV)', cost: 200000, power: 50, desc: 'å¤§è¦æ¨¡åŠ é€Ÿå™¨å®Ÿé¨“ã€‚' }
        ];

        const targets = [
            { id: 't1', name: 'Air (ç©ºæ°—)', cost: 0, power: 1 },
            { id: 't2', name: 'Gold Foil (é‡‘ç®”)', cost: 10000, power: 2 },
            { id: 't3', name: 'Liq. Hydrogen (æ¶²ä½“æ°´ç´ )', cost: 50000, power: 5 }
        ];

        const particles = [
            { id: 1, name: "Muon", rarity: 1 },
            { id: 2, name: "Electron", rarity: 1 },
            { id: 3, name: "Proton", rarity: 1 },
            { id: 4, name: "Pion", rarity: 2 },
            { id: 5, name: "Kaon", rarity: 3 },
            { id: 6, name: "J/psi", rarity: 4 },
            { id: 7, name: "Higgs", rarity: 5 }
        ];

        // === USER STATE ===
        let user = {
            money: 10000, // åˆæœŸè³‡é‡‘
            invMat: {},   // æ‰€æŒç´ æ {m1: 5, ...}
            invDet: [],   // æ‰€æŒæ¤œå‡ºå™¨ ['d1']
            invPart: {}   // æ‰€æŒç²’å­ {1: 0, ...} (æœªè§£æãƒ‡ãƒ¼ã‚¿æ•°)
        };

        // === SYSTEM ===
        window.onload = function() {
            loadGame();
            refreshUI();
            initProposalForm();
        };

        function showView(viewId) {
            document.querySelectorAll('.main-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆæ›´æ–°ï¼ˆç°¡æ˜“ï¼‰
            // å®Ÿéš›ã¯IDå¯¾å¿œãªã©ãŒå¿…è¦ã§ã™ãŒçœç•¥
        }

        function refreshUI() {
            document.getElementById('disp-money').innerText = user.money.toLocaleString();
            renderShop();
            renderCraft();
            renderOffice();
        }

        // 1. Shop Logic
        function renderShop() {
            const el = document.getElementById('shop-list');
            el.innerHTML = '';
            materials.forEach(m => {
                const count = user.invMat[m.id] || 0;
                el.innerHTML += `
                    <div class="item-card" onclick="buyMaterial('${m.id}')">
                        <div class="item-icon">${m.icon}</div>
                        <div style="font-weight:bold;">${m.name}</div>
                        <div style="color:var(--hc-green);">Â¥${m.cost.toLocaleString()}</div>
                        <div style="font-size:0.8rem; color:#888;">Owned: ${count}</div>
                    </div>
                `;
            });
        }
        function buyMaterial(id) {
            const item = materials.find(m => m.id === id);
            if(user.money >= item.cost) {
                user.money -= item.cost;
                user.invMat[id] = (user.invMat[id] || 0) + 1;
                saveGame();
                refreshUI();
            } else {
                alert("è³‡é‡‘ä¸è¶³ã§ã™ï¼");
            }
        }

        // 2. Craft Logic
        function renderCraft() {
            const el = document.getElementById('craft-list');
            el.innerHTML = '';
            detectors.forEach(d => {
                const owned = user.invDet.includes(d.id);
                // ãƒ¬ã‚·ãƒ”è¡¨ç¤º
                let reqStr = Object.keys(d.req).map(k => {
                    const mat = materials.find(m => m.id === k);
                    const has = user.invMat[k] || 0;
                    const need = d.req[k];
                    return `<span style="color:${has>=need?'white':'red'}">${mat.name} x${need}</span>`;
                }).join('<br>');

                el.innerHTML += `
                    <div class="item-card" style="border-color:${owned ? 'var(--hc-blue)' : ''}" onclick="craftDetector('${d.id}')">
                        <div style="font-weight:bold; font-size:1.1rem; color:var(--hc-orange)">${d.name}</div>
                        <div style="font-size:0.8rem; margin:10px 0; text-align:left;">${reqStr}</div>
                        <div style="background:${owned ? 'var(--hc-blue)' : '#333'}; padding:5px; border-radius:3px;">
                            ${owned ? 'OWNED' : 'CRAFT'}
                        </div>
                    </div>
                `;
            });
        }
        function craftDetector(id) {
            if(user.invDet.includes(id)) { alert("æ—¢ã«æ‰€æŒã—ã¦ã„ã¾ã™"); return; }
            const det = detectors.find(d => d.id === id);
            
            // ç´ æãƒã‚§ãƒƒã‚¯
            for(let k in det.req) {
                if((user.invMat[k] || 0) < det.req[k]) {
                    alert("ç´ æãŒè¶³ã‚Šã¾ã›ã‚“");
                    return;
                }
            }
            // æ¶ˆè²»
            for(let k in det.req) {
                user.invMat[k] -= det.req[k];
            }
            user.invDet.push(id);
            alert(`${det.name} ãŒå®Œæˆã—ã¾ã—ãŸï¼`);
            saveGame();
            refreshUI();
            initProposalForm(); // é¸æŠè‚¢æ›´æ–°
        }

        // 3. Proposal Logic
        function initProposalForm() {
            const selBeam = document.getElementById('sel-beam');
            const selTarget = document.getElementById('sel-target');
            const selDet = document.getElementById('sel-detector');

            // é¸æŠè‚¢ãƒªã‚»ãƒƒãƒˆ
            selBeam.innerHTML = beams.map(b => `<option value="${b.id}">${b.name} (Â¥${b.cost})</option>`).join('');
            selTarget.innerHTML = targets.map(t => `<option value="${t.id}">${t.name} (Â¥${t.cost})</option>`).join('');
            
            // æ¤œå‡ºå™¨ã¯æ‰€æŒã—ã¦ã„ã‚‹ã‚‚ã®ã ã‘
            if(user.invDet.length === 0) {
                selDet.innerHTML = `<option value="">(æ©ŸæãŒã‚ã‚Šã¾ã›ã‚“ - WORKSHOPã¸)</option>`;
            } else {
                selDet.innerHTML = user.invDet.map(did => {
                    const d = detectors.find(x => x.id === did);
                    return `<option value="${d.id}">${d.name}</option>`;
                }).join('');
            }
            calcProposalCost();
        }

        function calcProposalCost() {
            const bId = document.getElementById('sel-beam').value;
            const tId = document.getElementById('sel-target').value;
            if(!bId || !tId) return;

            const cost = beams.find(x=>x.id==bId).cost + targets.find(x=>x.id==tId).cost;
            document.getElementById('prop-cost').innerText = cost.toLocaleString();
            
            const btn = document.getElementById('btn-start-exp');
            const err = document.getElementById('exp-error');
            
            if(user.money < cost || user.invDet.length === 0) {
                btn.disabled = true;
                err.style.display = 'block';
            } else {
                btn.disabled = false;
                err.style.display = 'none';
            }
        }

        function runExperiment() {
            const bId = document.getElementById('sel-beam').value;
            const tId = document.getElementById('sel-target').value;
            const dId = document.getElementById('sel-detector').value;

            const beam = beams.find(x=>x.id==bId);
            const target = targets.find(x=>x.id==tId);
            const det = detectors.find(x=>x.id==dId);

            const totalCost = beam.cost + target.cost;
            user.money -= totalCost;

            // å®Ÿé¨“çµæœè¨ˆç®—
            // ãƒ‘ãƒ¯ãƒ¼ãŒé«˜ã„ã»ã©ãƒ¬ã‚¢ãŒå‡ºã‚„ã™ã„
            const totalPower = beam.power * target.power * det.power;
            
            // ç²’å­æŠ½é¸ (ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯)
            let foundParticle = particles[0]; // default muon
            const rand = Math.random() * 100;
            
            if(totalPower > 50 && rand < 5) foundParticle = particles[6]; // Higgs
            else if(totalPower > 20 && rand < 10) foundParticle = particles[5]; // J/psi
            else if(totalPower > 10 && rand < 20) foundParticle = particles[4]; // Kaon
            else if(rand < 40) foundParticle = particles[3]; // Pion
            else if(rand < 60) foundParticle = particles[2]; // Proton
            
            // ãƒ‡ãƒ¼ã‚¿ç²å¾— (ç²’å­ãã®ã‚‚ã®ã§ã¯ãªãã€è§£æç”¨ãƒ‡ãƒ¼ã‚¿ã‚’å¾—ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸)
            user.invPart[foundParticle.id] = (user.invPart[foundParticle.id] || 0) + 1;

            saveGame();
            refreshUI();

            // çµæœè¡¨ç¤º
            document.getElementById('exp-result-content').innerHTML = `
                <div style="font-size:3rem;">ğŸ’¥</div>
                <p>Experiment using <b>${beam.name}</b> on <b>${target.name}</b></p>
                <p>Detected candidate for: <b style="color:var(--hc-orange); font-size:1.5rem;">${foundParticle.name}</b></p>
                <p style="font-size:0.8rem; color:#aaa;">Data stored in Academic Office.</p>
            `;
            document.getElementById('result-modal').style.display = 'flex';
        }

        // 4. Academic Office Logic
        function renderOffice() {
            const el = document.getElementById('particle-stock-list');
            el.innerHTML = '';
            
            let hasData = false;
            particles.forEach(p => {
                const count = user.invPart[p.id] || 0;
                if(count > 0) {
                    hasData = true;
                    // å ±é…¬é¡: ãƒ¬ã‚¢åº¦ * 1000å††
                    const reward = p.rarity * 1000 * 2; 
                    
                    el.innerHTML += `
                        <div class="paper-card">
                            <div>
                                <h3 style="margin:0;">${p.name} Data</h3>
                                <div style="font-size:0.8rem; color:#666;">Unpublished Data: ${count}</div>
                            </div>
                            <button class="publish-btn" onclick="publishPaper(${p.id})">
                                PUBLISH (Â¥${reward.toLocaleString()})
                            </button>
                        </div>
                    `;
                }
            });
            if(!hasData) el.innerHTML = '<p style="text-align:center; color:#aaa;">No experimental data available.<br>Go to PROPOSAL to run experiments.</p>';
        }

        function publishPaper(pid) {
            if(!user.invPart[pid] || user.invPart[pid] <= 0) return;
            
            const p = particles.find(x => x.id === pid);
            const reward = p.rarity * 1000 * 2;

            user.invPart[pid]--; // ãƒ‡ãƒ¼ã‚¿æ¶ˆè²»
            user.money += reward;
            
            alert(`è«–æ–‡ã‚’ç™ºè¡¨ã—ã¾ã—ãŸï¼\nç ”ç©¶è²» Â¥${reward.toLocaleString()} ã‚’ç²å¾—ã—ã¾ã—ãŸã€‚`);
            saveGame();
            refreshUI();
        }

        // Save/Load
        function saveGame() { localStorage.setItem('hadron_v6', JSON.stringify(user)); }
        function loadGame() {
            const d = localStorage.getItem('hadron_v6');
            if(d) user = JSON.parse(d);
            // åˆæœŸã‚¢ã‚¤ãƒ†ãƒ ãŒãªã„å ´åˆã®æ•‘æ¸ˆ
            if(!user.invMat) user.invMat = {};
            if(!user.invDet) user.invDet = [];
            if(!user.invPart) user.invPart = {};
        }

    </script>
</body>
</html>
