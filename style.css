/* ===== Hadron Lab Style Ver 22.11 (Deck & Detail Fix) ===== */
:root {
    --hc-bg: #0a0e14;
    --hc-panel: #151922;
    --hc-border: #333;
    --hc-orange: #f39c12;
    --hc-blue: #3498db;
    --hc-green: #2ecc71;
    --hc-purple: #9b59b6;
    --hc-red: #e74c3c;
    --hc-text: #ecf0f1;
}

body { 
    margin: 0; background: var(--hc-bg); color: var(--hc-text); 
    font-family: 'M PLUS Rounded 1c', sans-serif; overflow: hidden; user-select: none; 
    /* バトル画面用の背景設定 */
    background-image: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000 100%);
}

/* ==============================
   共通・ホーム画面用スタイル
   ============================== */

/* 背景画像（ホーム画面用） */
.lab-container {
    width: 100vw; height: 100vh; position: relative;
    background-image: url('images/lab_bg.png'); 
    background-size: cover; background-position: center; 
    background-color: var(--hc-bg);
}

/* トップバー */
.top-bar {
    position: absolute; top: 0; left: 0; width: 100%; height: 50px;
    background: rgba(0,0,0,0.6); 
    display: flex; align-items: center; padding: 0 20px; gap: 20px; z-index: 100;
}
.status-box {
    background: rgba(40, 50, 60, 0.8); padding: 5px 15px; border-radius: 2px; border: 1px solid #555;
    display: flex; align-items: center; gap: 10px; font-family: 'Orbitron'; font-size: 0.9rem;
}

/* サイドバー */
.sidebar {
    position: absolute; top: 50px; left: 0; bottom: 0; width: 60px;
    background: rgba(0,0,0,0.8); border-right: 1px solid #444; 
    display: flex; flex-direction: column; z-index: 90; transition: 0.2s; overflow: hidden;
}
.sidebar:hover { width: 220px; }
.menu-item {
    height: 50px; display: flex; align-items: center; padding-left: 15px;
    color: #aaa; cursor: pointer; white-space: nowrap; transition: 0.2s; border-bottom: 1px solid #222;
}
.menu-item:hover, .menu-item.active { background: var(--hc-blue); color: white; }
.menu-icon { width: 30px; font-size: 1.2rem; text-align: center; margin-right: 10px; }

/* メインビュー */
.main-view {
    position: absolute; top: 50px; left: 0; right: 0; bottom: 0;
    padding: 40px; overflow-y: auto; display: none;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
    animation: fadeIn 0.3s; z-index: 80; padding-left: 80px;
}
.main-view.active { display: block; }

/* ホーム画面メニュー */
#view-home { background: transparent; backdrop-filter: none; pointer-events: none; }
.home-menu-container {
    position: absolute; top: 55%; left: 150px; transform: translateY(-50%);
    width: 450px; height: 450px; pointer-events: auto; z-index: 50;
}
.gear-btn {
    position: absolute; border-radius: 50%; 
    display: flex; justify-content: center; align-items: center; flex-direction: column;
    cursor: pointer; transition: 0.2s;
    box-shadow: 0 0 20px rgba(0,0,0,0.5); font-family: 'Orbitron'; font-weight: bold; border: 2px solid rgba(255,255,255,0.2);
    background-color: rgba(0,0,0,0.8); 
}
.gear-btn:hover { transform: scale(1.1); z-index: 100; filter: brightness(1.2); border-color: white; }
.btn-main { width: 170px; height: 170px; background: radial-gradient(circle, #e67e22, #d35400); border: 4px solid #f1c40f; color: #fff; font-size: 1.4rem; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; }
.btn-shop { width: 100px; height: 100px; background: #2ecc71; color: white; top: 15%; left: 15%; font-size: 0.8rem; }
.btn-deck { width: 100px; height: 100px; background: #9b59b6; color: white; top: 70%; left: 15%; font-size: 0.8rem; }
.btn-office { width: 100px; height: 100px; background: #3498db; color: white; top: 85%; left: 50%; transform: translateX(-50%); font-size: 0.8rem; }
.btn-battle { width: 110px; height: 110px; background: #c0392b; color: white; top: 65%; right: 5%; font-size: 0.9rem; border-color: #e74c3c; }
.btn-craft { width: 100px; height: 100px; background: #7f8c8d; color: white; top: 15%; right: 15%; font-size: 0.9rem; }
.btn-lab { width: 100px; height: 100px; background: #1abc9c; color: white; top: 5%; left: 50%; transform: translateX(-50%); font-size: 0.8rem; z-index: 20; }

/* デッキ表示エリア (ホーム画面の立ち絵) */
.deck-display-area {
    position: absolute; right: 20px; bottom: 20px; height: 60vh; width: 60vw; pointer-events: none; 
    display: flex; justify-content: flex-end; align-items: flex-end; z-index: 10;
}
.deck-member {
    width: 220px; height: auto; object-fit: contain; margin-right: -120px; border-radius: 10px;
    box-shadow: 5px 5px 15px rgba(0,0,0,0.8); transition: 0.3s; pointer-events: auto; cursor: pointer;
    transform-origin: bottom center; border: 2px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.5);
}
.deck-member.flagship { width: 260px; z-index: 20; border: 2px solid var(--hc-orange); }

/* =================================================================
   ★ここを大幅修正: 編成・カードスロット (縦長カードデザイン)
   ================================================================= */
.deck-slots { 
    display: flex; 
    justify-content: center; /* 中央寄せ */
    gap: 15px; /* カード間の隙間 */
    margin-bottom: 30px; 
    flex-wrap: wrap; /* 画面幅が狭いときは折り返す */
}

/* カード本体 */
.slot-card {
    width: 160px;  /* ★固定幅 */
    height: 240px; /* ★固定高さ（縦長） */
    background: #151922;
    border: 3px solid #444; /* デフォルトの枠線 */
    border-radius: 10px;
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center;
    cursor: pointer; 
    position: relative; 
    overflow: hidden;
    transition: 0.3s;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}

/* ホバー時の動き */
.slot-card:hover { 
    transform: translateY(-5px); 
    z-index: 10; 
}

/* ★レアリティ別の枠色と発光 */
.slot-card.card-common { border-color: #666; }
.slot-card.card-rare { 
    border-color: #3498db; 
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.4); 
}
.slot-card.card-holo { 
    border-color: #f1c40f; 
    box-shadow: 0 0 15px rgba(241, 196, 15, 0.5); 
}
.slot-card.card-ultra { 
    border-color: #e74c3c; 
    box-shadow: 0 0 20px rgba(231, 76, 60, 0.6); 
}
.slot-card.card-genesis { 
    border-color: #fff; 
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.6); 
    animation: border-rainbow 3s linear infinite; 
}

/* カード内の画像 */
.slot-card img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; /* ★枠いっぱいにトリミングして表示 */
    opacity: 0.9; 
    transition: 0.2s; 
}
.slot-card img:hover { 
    opacity: 1; 
    transform: scale(1.1); 
}

/* カード下部の名前ラベル */
.slot-label { 
    position: absolute; 
    bottom: 0; 
    width: 100%; 
    background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0)); 
    text-align: center; 
    padding: 10px 0 5px 0; 
    font-weight: bold; 
    color: var(--hc-orange); 
    pointer-events: none; 
    text-shadow: 0 2px 2px #000;
}

/* 削除ボタン */
.slot-remove { 
    position: absolute; 
    top: 5px; 
    right: 5px; 
    background: #e74c3c; 
    width: 24px; 
    height: 24px; 
    border-radius: 50%; 
    text-align: center; 
    line-height: 22px; 
    font-weight: bold; 
    color: white; 
    cursor: pointer; 
    z-index: 20; 
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}
.slot-remove:hover { transform: scale(1.1); background: red; }

/* アイテムカード (ショップなど) */
.shop-grid, .craft-grid, .particle-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
.item-card { 
    background: var(--hc-panel); border: 2px solid #444; padding: 10px; 
    text-align: center; cursor: pointer; border-radius: 8px; transition: 0.2s;
    position: relative; overflow: hidden;
}
.item-card:hover { transform: translateY(-3px); }

/* アイテムカード側のレアリティスタイル */
.card-common { border-color: #666; }
.card-rare { border-color: #3498db; box-shadow: 0 0 5px rgba(52, 152, 219, 0.2); }
.card-holo { border-color: #f1c40f; box-shadow: 0 0 10px rgba(241, 196, 15, 0.3); background: linear-gradient(135deg, #1a1a1a, #2a2200); }
.card-ultra { border-color: #e74c3c; box-shadow: 0 0 15px rgba(231, 76, 60, 0.4); background: linear-gradient(135deg, #1a1a1a, #2a0000); }
.card-genesis { 
    border-color: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.6); 
    animation: border-rainbow 3s linear infinite;
    background: linear-gradient(135deg, #000, #222);
}
.rarity-common { color: #aaa; }
.rarity-rare { color: #3498db; font-weight: bold; }
.rarity-holo { color: #f1c40f; text-shadow: 0 0 5px #f1c40f; font-weight: bold; }
.rarity-ultra { color: #e74c3c; text-shadow: 0 0 10px #e74c3c; font-weight: bold; font-size: 1.05rem; }
.rarity-genesis { 
    background: linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);
    background-size: 400%; -webkit-background-clip: text; color: transparent; 
    animation: rainbow 3s linear infinite; font-weight: bold; font-size: 1.1rem;
}
.rarity-label { font-size: 0.6rem; font-family: 'Orbitron'; letter-spacing: 1px; margin-bottom: 5px; color: #888; }
.label-rare { color: #3498db; }
.label-holo { color: #f1c40f; }
.label-ultra { color: #e74c3c; }
.label-genesis { color: #fff; text-shadow: 0 0 5px #fff; }

/* 名声バッジ */
.fame-badge { position: absolute; top: 0px; left: 0px; font-size: 1.5rem; color: #ffd700; text-shadow: 0 0 3px #000, 0 0 10px #ff8c00; z-index: 30; font-family: 'M PLUS Rounded 1c'; pointer-events: none; font-weight: bold; }
.fame-badge span { font-size: 0.8rem; color: #fff; vertical-align: middle; margin-left: -5px; }

/* ==============================
   バトル画面用スタイル
   ============================== */
.header { padding: 15px; display: flex; justify-content: space-between; background: rgba(0,0,0,0.8); border-bottom: 2px solid #444; z-index: 100; position: relative; }
.btn-back { padding: 10px 20px; background: transparent; border: 2px solid #555; color: white; cursor: pointer; font-family: 'Orbitron'; }

.battle-field { height: 55vh; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; position: relative; }

/* プレイヤーサイド */
.player-side { width: 50%; height: 100%; position: relative; display: flex; align-items: center; }
.fleet-container { position: relative; width: 100%; height: 300px; }
.fleet-member {
    position: absolute; height: 200px; width: auto; object-fit: contain;
    filter: drop-shadow(0 0 10px rgba(0,243,255,0.3));
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.fleet-member.flagship { height: 280px; z-index: 50 !important; filter: drop-shadow(0 0 20px rgba(255,215,0,0.6)); }
.fleet-member.attack { transform: translateX(100px) !important; filter: brightness(1.5); }
.fleet-member.damage { animation: shake 0.4s; filter: sepia(1) hue-rotate(-50deg) saturate(3); }

/* エネミーサイド */
.enemy-side { width: 40%; text-align: center; }
.enemy-core {
    width: 220px; height: 220px; border-radius: 50%; 
    background: radial-gradient(circle, #e74c3c, #8e44ad);
    box-shadow: 0 0 60px #c0392b; border: 6px solid #fff; margin: 0 auto;
    display: flex; justify-content: center; align-items: center; font-size: 3rem; font-weight: bold;
    text-shadow: 2px 2px 0 #000; animation: pulse 3s infinite; position: relative;
}
.enemy-core.damage { animation: shake 0.3s; background: white; }

/* コマンドパネル */
.command-panel {
    position: absolute; bottom: 0; width: 100%; height: 30vh;
    background: rgba(16, 20, 30, 0.95); border-top: 2px solid #3498db;
    display: flex; align-items: center; padding: 0 40px; gap: 20px; box-sizing: border-box;
}
.log-window {
    flex: 1.5; height: 80%; background: #000; border: 1px solid #444; padding: 10px;
    overflow-y: auto; font-family: monospace; color: #aaa; font-size: 0.9rem; line-height: 1.6;
}
.command-grid { flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.cmd-btn {
    padding: 15px; font-family: 'Orbitron'; font-size: 1.1rem; cursor: pointer;
    background: linear-gradient(135deg, #2c3e50, #000); border: 1px solid #555; color: white;
    border-radius: 5px; transition: 0.2s; position: relative;
}
.cmd-btn:hover { border-color: var(--color); box-shadow: 0 0 15px var(--color); transform: translateY(-2px); }
.cmd-btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

/* ステータスバー・バフ */
.fleet-stats-box {
    position: absolute; top: -40px; left: 20px; width: 300px;
    background: rgba(0,0,0,0.7); border: 1px solid #3498db; padding: 10px; border-radius: 5px; z-index: 100;
}
.bar-container { width: 100%; height: 8px; background: #333; margin: 3px 0; border-radius: 4px; overflow: hidden; }
.hp-bar { height: 100%; background: #2ecc71; width: 100%; transition: 0.3s; }
.ep-bar { height: 100%; background: #f1c40f; width: 0%; transition: 0.3s; }
.buff-list { font-size: 0.7rem; color: #aaa; margin-top: 5px; display: flex; flex-wrap: wrap; gap: 5px; }
.buff-tag { background: rgba(52, 152, 219, 0.3); padding: 2px 6px; border-radius: 3px; border: 1px solid rgba(52, 152, 219, 0.5); color: #81ecec; }

/* エフェクト */
.skill-cutin {
    position: fixed; top: 30%; left: 0; width: 100%; background: rgba(52, 152, 219, 0.9);
    color: white; font-size: 3rem; font-family: 'Orbitron'; font-weight: bold; font-style: italic;
    text-align: center; padding: 20px 0; transform: translateX(-100%); z-index: 200; display: none;
}
.skill-cutin.active { display: block; animation: cutIn 1.5s ease-in-out; }
.damage-pop, .heal-pop {
    position: absolute; font-family: 'Orbitron'; font-weight: bold; font-size: 3rem;
    text-shadow: 0 0 5px #000; pointer-events: none; z-index: 100; animation: popUp 0.8s forwards;
}
.damage-pop { color: #fff; text-shadow: 0 0 10px #e74c3c; }
.heal-pop { color: #2ecc71; text-shadow: 0 0 10px #27ae60; font-size: 2.5rem; }

/* ミッション */
.mission-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
.mission-card { background: linear-gradient(135deg, #222, #111); border: 2px solid #444; border-radius: 10px; padding: 20px; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; }
.mission-card:hover { transform: translateY(-5px); border-color: var(--hc-blue); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); }
.mission-tag { position: absolute; top: 10px; right: 10px; font-size: 0.7rem; padding: 2px 8px; border-radius: 3px; background: #333; }
.tag-money { color: #f1c40f; border: 1px solid #f1c40f; }
.tag-mat { color: #2ecc71; border: 1px solid #2ecc71; }
.tag-boss { color: #e74c3c; border: 1px solid #e74c3c; font-weight: bold; }

/* スキルツリー */
.skill-tree-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding-bottom: 50px; }
.skill-card { background: #111; border: 1px solid #444; border-radius: 8px; padding: 15px; position: relative; transition: 0.3s; opacity: 0.7; }
.skill-card.unlocked { border-color: var(--hc-blue); background: linear-gradient(135deg, #15202b, #000); box-shadow: 0 0 10px rgba(52, 152, 219, 0.2); opacity: 1; }
.skill-card.purchasable { border-color: var(--hc-green); opacity: 1; cursor: pointer; }
.skill-card.purchasable:hover { transform: translateY(-3px); box-shadow: 0 0 15px rgba(46, 204, 113, 0.4); }
.skill-card.locked { filter: grayscale(1); border-style: dashed; }
.skill-icon { font-size: 2rem; margin-bottom: 10px; }
.skill-name { font-family: 'Orbitron'; font-weight: bold; color: #fff; margin-bottom: 5px; }
.skill-desc { font-size: 0.85rem; color: #aaa; margin-bottom: 10px; line-height: 1.4; }
.skill-cost { font-weight: bold; color: var(--hc-blue); font-size: 0.9rem; }
.skill-status { position: absolute; top: 10px; right: 10px; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; }
.st-acquired { background: var(--hc-blue); color: white; }
.st-can-buy { background: var(--hc-green); color: white; animation: pulse 2s infinite; }
.st-locked { background: #333; color: #777; }

/* アニメーション定義 */
@keyframes rainbow { 0%{background-position:0% 50%} 100%{background-position:100% 50%} }
@keyframes border-rainbow { 0%{border-color: #ff0000;} 20%{border-color: #ffff00;} 40%{border-color: #00ff00;} 60%{border-color: #00ffff;} 80%{border-color: #0000ff;} 100%{border-color: #ff00ff;} }
@keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.02)} }
@keyframes shake { 0%{transform:translate(0,0)} 25%{transform:translate(-5px,5px)} 50%{transform:translate(5px,-5px)} 75%{transform:translate(-5px,-5px)} 100%{transform:translate(0,0)} }
@keyframes popUp { 0%{transform:translateY(0);opacity:1} 100%{transform:translateY(-50px);opacity:0} }
@keyframes cutIn { 0%{transform:translateX(-100%)} 20%{transform:translateX(0)} 80%{transform:translateX(0)} 100%{transform:translateX(100%)} }

/* モーダル（ポップアップ画面の背景） */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 2000;
    display: none;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
}

/* モーダルの中身 */
.modal-content {
    background: #111;
    padding: 40px;
    width: 80%;
    max-width: 600px;
    border-radius: 15px;
    border: 2px solid var(--hc-blue);
    text-align: center;
    box-shadow: 0 0 30px rgba(52, 152, 219, 0.3);
    color: white;
    font-family: 'Orbitron', sans-serif;
    animation: popUp 0.5s ease-out;
}

#loot-display {
    font-size: 1.2rem;
    margin: 20px 0;
    line-height: 1.8;
    color: #ecf0f1;
}

/* ★詳細画面の画像はみ出し防止用スタイル */
.detail-layout { 
    display: flex; 
    gap: 20px; 
    align-items: flex-start; 
    text-align: left; 
    /* 中身が大きすぎてもスクロールできるように */
    max-height: 70vh; 
    overflow-y: auto; 
}

.detail-img-box { 
    width: 40%; 
    flex-shrink: 0; 
    text-align: center; 
    background: radial-gradient(circle, #333, #000); 
    padding: 10px; 
    border-radius: 10px; 
    border: 1px solid #555; 
    
    /* 画像を中央に配置 */
    display: flex;
    justify-content: center;
    align-items: center;
}

.detail-img-box img { 
    max-width: 100%; 
    max-height: 400px; /* ★高さ制限を追加して画面からはみ出さないように */
    width: auto;       /* アスペクト比を維持 */
    object-fit: contain; 
    filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); 
}

.detail-info { 
    width: 55%; 
}

/* ==============================
   ★ガチャ結果画面のスタイル修正（ここを追加）
   ============================== */

/* 10連ガチャのグリッドレイアウト */
.gacha-grid {
    display: grid;
    /* 最小100pxの幅で、画面幅に合わせて自動で列数を調整 */
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 15px; /* アイテム間の隙間 */
    margin-top: 20px;
    max-height: 60vh; /* 結果が多い場合にスクロールできるように高さを制限 */
    overflow-y: auto; /* 縦スクロールを許可 */
    padding: 10px; /* スクロールバーとの干渉を防ぐパディング */
}

/* 各ガチャ結果アイテムのコンテナ */
.gacha-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

/* ガチャ結果の画像（重要：サイズを枠内に収める） */
.gacha-item img {
    width: 100%;       /* 親要素（.gacha-item）の幅に合わせる */
    height: 100px;     /* 高さを固定して揃える（任意で調整可能） */
    object-fit: cover; /* 枠に合わせてトリミング表示 */
    border-radius: 8px; /* 角丸 */
    border: 2px solid #444; /* 枠線 */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* 影 */
    background: #222; /* 背景色 */
    margin-bottom: 5px; /* 名前との間隔 */
}
